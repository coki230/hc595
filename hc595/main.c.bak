#include <REGX51.H>
#include <INTRINS.H>
// 行扫描
sbit shcp_h=P2^0;
sbit ds_h=P2^1;
sbit stcp_h=P2^2;
// 列扫描
sbit shcp_l=P2^3;
sbit ds_l=P2^4;
sbit stcp_l=P2^5;

unsigned char tab[3][32] = {
/*--  Fixedsys12;  此字体下对应的点阵为：宽x高=16x16   --*/
{0x10,0x20,0x10,0x20,0x11,0xFC,0x10,0x20,0xFC,0x20,0x24,0x20,0x27,0xFE,0x24,0x00,
0x24,0x20,0x48,0x20,0x29,0xFC,0x10,0x20,0x28,0x20,0x44,0x20,0x83,0xFE,0x00,0x00},
/*--  文字:  哈  --*/
/*--  Fixedsys12;  此字体下对应的点阵为：宽x高=16x16   --*/
{0x00,0x40,0x00,0x40,0x78,0xA0,0x49,0x10,0x4A,0x08,0x4C,0x06,0x4B,0xF8,0x48,0x00,
0x48,0x00,0x4B,0xF8,0x7A,0x08,0x4A,0x08,0x02,0x08,0x02,0x08,0x03,0xF8,0x02,0x08},

/*--  文字:  哈  --*/
/*--  Fixedsys12;  此字体下对应的点阵为：宽x高=16x16   --*/
{0x00,0x40,0x00,0x40,0x78,0xA0,0x49,0x10,0x4A,0x08,0x4C,0x06,0x4B,0xF8,0x48,0x00,
0x48,0x00,0x4B,0xF8,0x7A,0x08,0x4A,0x08,0x02,0x08,0x02,0x08,0x03,0xF8,0x02,0x08}
};

// 行扫描函数
void sendbyte_h(int index){
	unsigned char i;
	for(i = 0; i < 16; i++) {
		shcp_h = 0;
		if ((16 - index) == i)
		{
			ds_h = 0;
		} else {
			ds_h = 1;
		}
		shcp_h = 1;
	}
	
}

// 列扫描函数
void sendbyte_l(unsigned char a, unsigned char b){
	unsigned char i;
	// 取反数据
//	a = ~a;
//	b = ~b;
	for(i = 0; i < 8; i++) {
		shcp_l = 0;
		ds_l = b & 0x01;
		b = b >> 1;
		shcp_l = 1;
	}
	for(i = 0; i < 8; i++) {
		shcp_l = 0;
		ds_l = a & 0x01;
		a = a >> 1;
		shcp_l = 1;
	}
	

}
void show(){
	stcp_h = 0;
	stcp_l = 0;
	_nop_();
	stcp_h = 1;
	stcp_l = 1;
}

void main() {
	unsigned char i, j;
	unsigned int f = 5;
	unsigned int n = 50;
	while(1){
		for(j = 0; j < 3; j++) {
			while(n--) {
				for(i = 0; i < 16; i++) {
					sendbyte_l(tab[j][2 * i], tab[j][2 * i + 1]);
					sendbyte_h(i + 1);
					show();
	//				while(f--);
				}
			}
		}

//			sendbyte_h(0x36,0x45);
//			sendbyte_l(1);
//			show();
//			while(f--);
	}
}

